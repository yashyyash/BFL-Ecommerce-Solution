<div class="container my-4">
  <h2 class="mb-4">Products</h2>

  <div class="row">
    @for (product of products; track product._id) {
      <div class="col-12 col-sm-6 col-md-4 col-lg-3 mb-4">
        <div class="card h-100 shadow-sm border-warning">

          <!-- Product images -->
          <div id="carousel-@product._id" class="carousel slide" data-bs-ride="carousel">
            <div class="carousel-inner">
              @for (img of product.images; track img) {
                <div class="carousel-item" [class.active]="product.images.indexOf(img) === 0">
                  <img [src]="img" class="d-block w-100" [alt]="product.name" style="height: 200px; object-fit: cover;" />
                </div>
              } @empty {
                <!-- Fallback if there are no images -->
                <div class="carousel-item active">
                  <img src="https://placehold.co/600x400/eeeeee/aaaaaa?text=No+Image" class="d-block w-100" [alt]="product.name" style="height: 200px; object-fit: cover;" />
                </div>
              }
            </div>
          <!-- <button class="carousel-control-prev" type="button" [attr.data-bs-target]="'#carousel-' + product._id" data-bs-slide="prev">
          <span class="carousel-control-prev-icon"></span>
          <span class="visually-hidden">Previous</span>
          </button>
          <button class="carousel-control-next" type="button" [attr.data-bs-target]="'#carousel-' + product._id" data-bs-slide="next">
          <span class="carousel-control-next-icon"></span>
          <span class="visually-hidden">Next</span>
          </button> -->
          </div>

          <!-- Card body -->
          <div class="card-body">
            <h5 class="card-title">@{{product.name}}</h5>
            <p class="text-muted mb-1">{{product.brand}}</p>
            <p class="mb-1"><strong>Category:</strong> {{product.categoryId.name}}</p>

            @if (product.discount > 0) {
              <p class="mb-1">
                <strong>Price:</strong> ${{ product.price | number:'1.2-2' }}
                <span class="badge bg-warning text-dark ms-2">-{{product.discount}}%</span>
              </p>
            } @else {
              <p class="mb-1"><strong>Price:</strong> ${{ product.price | number:'1.2-2' }}</p>
            }

            <p class="mb-1"><strong>Stock:</strong> {{product.stock}}</p>
            <p class="mb-1"><strong>Rating:</strong> {{ product.rating | number:'1.1-2' }}</p>

            @if (product.isFeatured) {
              <span class="badge bg-success mt-1 d-inline-block">Featured</span>
            }
          </div>

          <!-- 
            UPDATED BUTTONS SECTION:
            - Single card-footer
            - 'd-flex' and 'gap-2' for side-by-side layout
            - 'flex-fill' to make buttons equal width
            - 'btn-outline-success' for Add to Cart
            - (click)="addToCart(product)" for Add to Cart
          -->
          <div class="card-footer d-flex gap-2">
            <button class="btn btn-sm btn-outline-warning flex-fill" (click)="viewDetails(product._id)">
              View Details
            </button>
            
            <!-- FIXED: Added closing parenthesis ')' -->
            <button class="btn btn-sm btn-outline-success flex-fill" (click)="addToCart(product)">
              Add to Cart
            </button>
          </div>

        </div>
      </div>
    }
  </div>
  
  <nav aria-label="Page navigation example" class="mt-4">
    <button class="btn btn-sm btn-outline-primary me-1"
            [disabled]="currentPage === 1"
            (click)="loadPage(currentPage - 1)">
      Previous
    </button>

    @for(page of totalPagesArray; track page){
      <button class="btn btn-sm me-1"
              [class.btn-primary]="page === currentPage"
              [class.btn-outline-primary]="page !== currentPage"
              (click)="loadPage(page)">{{page}}
      </button>
    } 

    <button class="btn btn-sm btn-outline-primary ms-1"
            [disabled]="currentPage === totalPages"
            (click)="loadPage(currentPage + 1)">
      Next
    </button>
  </nav>
</div> <!-- This closes div.container -->

<!-- REMOVED: Extra '}' was here -->

@if (selectedProductId) {
  <!-- <app-product-detail [productId]="selectedProductId"></app-product-detail> -->
    <div class="product-modal-backdrop" (click)="closeDetail()"></div>
  <div class="product-modal">
    <div class="modal-header">
      <h5 class="modal-title">Product Details</h5>
      <button class="btn-close" (click)="closeDetail()"></button>
    </div>
    <div class="modal-body">
      <app-product-detail [productId]="selectedProductId"></app-product-detail>
    </div>
  </div>
}

